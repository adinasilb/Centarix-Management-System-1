@model PrototypeWithAuth.ViewModels.ConfirmEmailViewModel
@using PrototypeWithAuth.AppData;

@{
    char currency = '₪';
    decimal vat = 0;
 if (Model.Requests.Count() == 1 && Model.Requests[0].Currency == AppUtility.CurrencyEnum.USD.ToString())
 {
     currency = '$';
 }
 var colspan = 4;
}
<div style="padding:1rem 2rem">
    <header class="page-header">
        <div class="row">
            <div class="col-md-6 company-logo">
                <br />
                <img src="~/images/centarix_logo-02.png" width="400" alt="Centarix Logo">
            </div>
            <div class="col-md-3 offset-3 pt-3 company-info">
                <span style="font-weight: 700; font-size:1.5rem;">Centarix Biotech</span><br>
                <span>ID: 51565512</span><br>
                <span>Hamarpeh 3, Jerusalem</span><br>
                <span>Tel: 073-7896888</span>
            </div>
        </div>
        <hr>
    </header>
    <div class="row">
        <div class="col-6">
            @if (Model.RequestIndexObject.PageType == AppUtility.PageTypeEnum.LabManagementQuotes &&
Model.RequestIndexObject.SidebarType == AppUtility.SidebarEnum.Quotes)
            {
                <span style="font-weight: 700; font-size:2rem;">Request Price Quote</span>
            }
            else
            {
                <span style="font-weight: 700; font-size:2rem;">Purchase Order: @Model.ParentRequest.OrderNumber</span>
            }
        </div>
        <div class="col-3 offset-3 text-center">
            <span style="font-weight:500" id="date"></span>
        </div>
    </div>
    <hr>
    <div class="row">
        <div class="col-4">
            <div class="vendor-info">
                <span class="heading-1">@Model.Requests[0].Product.Vendor.VendorEnName</span><br>
                <span>ID: @Model.Requests[0].Product.Vendor.VendorBuisnessID</span><br>
                <span>@Model.Requests[0].Product.Vendor.VendorCity</span><br>
                <span>Tel: @Model.Requests[0].Product.Vendor.VendorTelephone</span>
            </div>
        </div>
        <div class="col-6 offset-2">
            <div class="note-message p-4 pl-5">


                @{
                    var notes = "";
                    foreach (var request in Model.Requests)
                    {
                        if (!string.IsNullOrEmpty(request.NoteToSupplier))
                        {
                            notes += "<span class='text'>" + @request.NoteToSupplier + "</span><br/>";
                        }
                    }
                    if (notes != "")
                    { <span class="heading-1">Please Note:</span><br> }
                    @Html.Raw(notes);
                    
                }
            </div>
        </div>
    </div>
    <br>
    <div class="row">
        <table class="table confirm-table">
            <thead style="background-color: #D0001C; color: #ffffff;">
                <tr>
                    @if (Model.Requests[0].Product.ProductSubcategory.ParentCategory.CategoryTypeID == 1)
                    {
                        <th style="width:30%;">Items</th>
                        <th style="width:15%;">SKU</th>
                        <th style="width:8%;">Units</th>
                        <th style="width:16%;">Price</th>
                        <th style="width:15%;">Discount</th>
                        <th style="width:16%;">Total</th>
                    }
                    else
                    {
                        <th>Items</th>
                        <th>SKU</th>

                        <th>Total</th>
                    }

                </tr>
            </thead>
            <tbody>

                @foreach (var request in Model.Requests)
                {
                    var cost = request.Cost;
                    vat += request.VAT;
                    if (request.Currency == AppUtility.CurrencyEnum.USD.ToString())
                    {
                        cost = cost / request.ExchangeRate;
                    }
                    <tr>
                        <td style="font-weight: 500;">@request.Product.ProductName</td>
                        <td>@request.Product.CatalogNumber</td>
                        @if (request.Product.ProductSubcategory.ParentCategory.CategoryTypeID == 1)
                        {
                            <td>@request.Unit</td>
                            decimal unitPrice = (cost ?? 0) / request.Unit;
                            <td>@currency @unitPrice.ToString("N2")</td>
                        }
                        <td>@request.Discount%</td>
                        <td>@currency @cost?.ToString("N2")</td>
                    </tr>
                }
                @{ decimal total = Model.Requests.Sum(r => r.Cost ?? 0);
                    if (currency == '$')
                    {
                        vat= vat/ Model.Requests[0].ExchangeRate;
                        total = total / Model.Requests[0].ExchangeRate;
                    }
                    decimal totalWithVat = total + vat;}
                <tr>
                    <td colspan="@colspan" rowspan="6" class="borderless-cell">
                        <img src="~/images/css/centarix_logo_signature.png" alt="signature" width="250" class="mt-5">
                    </td>
                    <td>Total</td>
                    <td>@currency @total.ToString("N2")</td>
                </tr>
                <tr>
                    <td>VAT [17%]</td>
                    @* make the vat a global variable*@
                    <td>@currency @vat.ToString("N2")</td>
                </tr>
                <tr>
                    <td style="font-weight: bold;">Total To Pay</td>

                    <td style="font-weight: bold;">@currency @totalWithVat.ToString("N2")</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>
<br />
<br />
<br />
<br />
<br />
<br />
