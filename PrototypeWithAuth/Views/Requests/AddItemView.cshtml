@model PrototypeWithAuth.ViewModels.TempListWithRequestItem
@*@inject UserManager<ApplicationUser> UserManager*@
@{
    ViewData["Title"] = "Add Item";

    Layout = "~/Views/Shared/RequestNavView.cshtml";

    string form = "order-inv-form";
    if (Model.RequestItemViewModel.SectionType == AppUtility.MenuItems.Operations)
    {
        form = "oper-form";
    }
}

@using Microsoft.AspNetCore.Identity
@using PrototypeWithAuth.Data
@using PrototypeWithAuth.AppData
@inject UserManager<ApplicationUser> _userManager

<div class="col-12 create-user mx-auto @form on-form-modal " style="width: 60%">
    <div class="on-form-modal-border">
        <form action="" id="myForm" class="ordersItemForm" method="post" enctype="multipart/form-data" style=" ">
            @{ await Html.RenderPartialAsync("_TempRequestHiddenFors.cshtml", Model.TempRequestListViewModel); }
            <div class="outer-partial">

                @{ await Html.RenderPartialAsync("CreateItemTabs", Model.RequestItemViewModel); }
            </div>
        </form>
    </div>
</div>

<script>
    $.fn.SubmitOrderFromAddItemView = function (OrderType) {
        console.log("in submitorderfromadditemview");
        var formData = new FormData($("#myForm")[0]);
        for (var pair of formData.entries()) {
            console.log(pair[0] + ', ' + pair[1]);
        }
        $.ajax({
            contentType: false,
            processData: false,
            async: true,
            url: "/Requests/AddItemView?OrderType=" + orderType,
            data: formData,
            traditional: true,
            type: "POST",
            cache: false,
            success: function (data) {
                console.log("in success of ajax call ");
                $.fn.OpenModal('modalStep1', 'step-1', data)
                $("#loading").hide();
                return true;
            },
            error: function (jqxhr) {
                console.log("in error of ajax call ");
                $("#loading").hide();
                if (jqxhr.status == 500) {
                    // alert("made it to error")
                    $("#order").html(jqxhr.responseText);
                    $(".order-tab").trigger("click");
                }
            }
        });
    };
    $(".submitOrderHidden").off('click').on("click", function (e) {
        var formData = new FormData($("#myForm")[0]);
        console.log(...formData);
        for (var pair of formData.entries()) {
            console.log(pair[0] + ', ' + pair[1]);
        }
        

        //return false;
    });</script>
