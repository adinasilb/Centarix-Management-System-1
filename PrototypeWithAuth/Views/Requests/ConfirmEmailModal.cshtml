@model PrototypeWithAuth.ViewModels.ConfirmEmailViewModel
@using PrototypeWithAuth.AppData
@{
    Layout = null;
    var bcColor = "order-inv-background-color";
    if (Model.RequestIndexObject.SectionType == AppUtility.MenuItems.Operations)
    {
        bcColor = "oper-background-color";
    }
    else if (Model.RequestIndexObject.SectionType == AppUtility.MenuItems.Requests)
    {
        bcColor = "order-inv-background-color";
    }
    char currency = '₪';
    if (Model.Requests.Count() == 1 && Model.Requests.FirstOrDefault().Currency == AppUtility.CurrencyEnum.USD.ToString())
    {
        currency = '$';
    }
}
@{


    var colspan = 1;
    @if (Model.Requests.FirstOrDefault().Product.ProductSubcategory.ParentCategory.CategoryTypeID == 1)
    {

        colspan = 3;
    }


    <div class="modal modal-view overflow-auto email-model" id="myModal" role="dialog" aria-labelledby="Request" data-backdrop="false">

        <div class="modal-dialog modal-lg" role="document" style="max-height:100%; max-width:60rem; ">

            <div class="modal-content d-inline-block" style="width:58.96rem;">

                <div class="modal-header pb-0 border-bottom-0">
                    <button type="button" class="close modal-close-padding modal-close-style" data-dismiss="modal" aria-label="Close" onclick="$(this).closest('.modal').modal('hide');">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>

                <form action="" method="post" enctype="multipart/form-data" style="height: 100%; ">
                    <input asp-for="RequestID" style="display: none;" />



                    @*<div class="modal-body">
                            @if (IsBeingApproved == "True")
                            {
                                <h4>Would you like to approve this Request for @Model.Request.Product.ProductName ?</h4>
                            }
                        </div>*@

                    @*<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">*@

                    <div style="padding:1rem 2rem">
                        <header class="page-header">
                            <div class="row">
                                <div class="col-md-6 company-logo">
                                    <br />
                                    <img src="~/images/centarix_logo-02.png" width="400" alt="Centarix Logo">
                                </div>
                                <div class="col-md-3 offset-3 pt-3 company-info">
                                    <span style="font-weight: 700; font-size:1.5rem;">Centarix Biotech</span><br>
                                    <span>ID: 51565512</span><br>
                                    <span>Hamarpeh 3, Jerusalem</span><br>
                                    <span>Tel: 073-7896888</span>
                                </div>
                            </div>
                            <hr>
                        </header>
                        <div class="row">
                            <div class="col-6">
                                <span style="font-weight: 700; font-size:2rem;">Purchase Order: @Model.ParentRequest.OrderNumber</span>
                            </div>
                            <div class="col-3 offset-3 text-center">
                                <span style="font-weight:500" id="date"></span>
                            </div>
                        </div>
                        <hr>
                        <div class="row">
                            <div class="col-4">
                                <div class="vendor-info">
                                    <span class="heading-1">@Model.Requests.FirstOrDefault().Product.Vendor.VendorEnName</span><br>
                                    <span>ID: @Model.Requests.FirstOrDefault().Product.Vendor.VendorBuisnessID</span><br>
                                    <span>@Model.Requests.FirstOrDefault().Product.Vendor.VendorCity</span><br>
                                    <span>Tel: @Model.Requests.FirstOrDefault().Product.Vendor.VendorTelephone</span>
                                </div>
                            </div>
                            <div class="col-6 offset-2">
                                <div class="note-message p-4 pl-5">
                                    <span class="heading-1">Please Note</span><br>
                                    @foreach (var request in Model.Requests)
                                    {
                                        if (!string.IsNullOrEmpty(request.NoteToSupplier))
                                        {
                                            <span class="text">
                                                @request.Product.ProductName: @request.NoteToSupplier
                                            </span>
                                        }
                                    }
                                </div>
                            </div>
                        </div>
                        <br>
                        <div class="row">
                            <table class="table confirm-table">
                                <thead style="background-color: #D0001C; color: #ffffff;">
                                    <tr>
                                        @if (Model.Requests.FirstOrDefault().Product.ProductSubcategory.ParentCategory.CategoryTypeID == 1)
                                        {
                                            <th style="width:40%;">Items</th>
                                            <th style="width:18%;">SKU</th>
                                            <th style="width:10%;">Units</th>
                                            <th style="width:20%;">Price</th>
                                            <th style="width:12%;">Total</th>
                                        }
                                        else
                                        {
                                            <th>Items</th>
                                            <th>SKU</th>

                                            <th>Total</th>
                                        }

                                    </tr>
                                </thead>
                                <tbody>
                                    @*@for (int i = 0; i < Model.Requests.Count(); i++)
                                        {

                                            <tr>
                                                <td style="font-weight: 500;">@Model.Requests[i].SubUnit @Model.Requests[i].Product.ProductName</td>
                                                <td>@Model.Requests[i].CatalogNumber</td>
                                                @if (@Model.Requests[i].Product.ProductSubcategory.ParentCategory.CategoryTypeID == 1)
                                                {
                                                    <td>@Model.Requests[i].Unit</td>
                                                    double unitPrice = (Model.Requests[i].Cost) / Model.Requests[i].Unit;
                                                    <td>@unitPrice.ToString("N2")</td>
                                                }

                                                <td>@Model.Requests[i].Cost</td>
                                            </tr>


                                        }*@
                                    @foreach (var request in Model.Requests)
                                    {
                                        <tr>
                                            <td style="font-weight: 500;">@request.SubUnit @request.Product.ProductName</td>
                                            <td>@request.CatalogNumber</td>
                                            @if (request.Product.ProductSubcategory.ParentCategory.CategoryTypeID == 1)
                                            {
                                                <td>@request.Unit</td>
                                                double unitPrice = (request.Cost) / request.Unit;
                                                <td>@currency @unitPrice.ToString("N2")</td>
                                            }

                                            <td>@currency @request.Cost</td>
                                        </tr>
                                    }
                                    @{ double total = Model.Requests.Sum(r => r.Cost);
                                        double vat = total * .17;
                                        double totalWithVat = total + vat;}
                                    <tr>
                                        <td colspan="@colspan" rowspan="5" class="borderless-cell">
                                            <img src="~/images/css/centarix_logo_signature.png" alt="signature" width="250" class="mt-5">
                                        </td>
                                        <td>Total</td>
                                        <td>@currency @total.ToString("N2")</td>
                                    </tr>

                                    <tr>
                                        <td>Discount @*@Html.DisplayFor(modelItem => Model.Request.)*@</td>
                                        @*@{double discount = Model.Request.Cost * Model.Request.Discount; }*@
                                        <td>@*discount*@</td>

                                    </tr>
                                    <tr>
                                        <td>Total Price</td>
                                        @*@{ double totalWithDis = Model.Request.Cost - discount}*@
                                        <td>@*@totalWithDis*@</td>
                                    </tr>
                                    <tr>
                                        <td>VAT [17%]</td>
                                        @* make the vat a global variable*@
                                        <td>@currency @vat.ToString("N2")</td>
                                    </tr>
                                    <tr>
                                        <td style="font-weight: bold;">Total To Pay</td>

                                        <td style="font-weight: bold;">@currency @totalWithVat.ToString("N2")</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <br>
                        <br>
                        <br>
                        <br>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="payment-terms">
                                    <span style="font-weight:700; font-size:1.5rem;">Payment Terms</span><br>
                                    <span class="payment-terms">@Model.Requests.FirstOrDefault().Terms</span>
                                </div>
                            </div>
                        </div>
                        <br />
                        <br />
                        <div class="modal-footer p-4">
                            <div class="m-auto">
                                <input type="submit" class="custom-button custom-button-font @bcColor between-button-margin" asp-action="ConfirmEmailModal" value="Confirm & Send Email" />

                                <input type="submit" class="custom-cancel custom-button cancel-email" asp-action="CancelEmailModal" value="Cancel Email"/>
                            </div>
                        </div>
                    </div>

                    <script>
                        var today = new Date();
                        var date = today.getDate() + '/' + (today.getMonth() + 1) + '/' + today.getFullYear();
                        document.getElementById("date").innerHTML = date;
                    </script>


                </form>

            </div>
        </div>
    </div>
}