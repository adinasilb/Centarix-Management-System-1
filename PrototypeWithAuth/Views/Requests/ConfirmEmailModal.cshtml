@model PrototypeWithAuth.ViewModels.ConfirmEmailViewModel
@{
   
    var IsBeingApproved = TempData["IsBeingApproved"].ToString(); //have to use string and not bool b/c it's tempdata
    var blocked = false;
    if (!User.IsInRole("Admin") && IsBeingApproved == "True")//added the isinrole for added security
    {
        blocked = true;
    }
}

<div class="modal modal-view faid " id="myModal" role="dialog" aria-labelledby="Request" data-backdrop="false">
    <div class="modal-dialog  modal-dialog-scrollable modal-lg">
        <div class="modal-content d-inline-block">

            <div class="modal-header border-bottom-0">
                Confirm Email
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>

            @if (blocked)
            {
                <span>Only admins have access to this page</span>
                @Html.ActionLink("Continue", "Index", "Requests");
            }
            else
            {
        <form action="" method="post" enctype="multipart/form-data" style="height: 100%; overflow: auto;">
            @Html.HiddenFor(m => m.Request.RequestID)

            @*THE FOLLOWING HIDDEN VALUES ARE TO REMEMBER THE REQUESTS INDEX PAGE FROM BEFORE*@
            @*the values for the hidden data is set in js on the modal success area off of the tempdata*@
            @Html.HiddenFor(model => model.Page)
            @Html.HiddenFor(model => model.RequestStatusID)
            @Html.HiddenFor(model => model.SubCategoryID)
            @Html.HiddenFor(model => model.VendorID)
            @Html.HiddenFor(model => model.ApplicationUserID) @*MAKE SURE THIS IS DOING IT CORRECTLY --> make sure js is parsing it as a string*@
            @Html.HiddenFor(model => model.PageType) @*JS shoulde be taking this as a string *@


            <div class="modal-body">
                @if (IsBeingApproved == "True")
                {
                    <h4>Would you like to approve this Request for @Model.Request.Product.ProductName ?</h4>
                }
            
            </div>


            @*<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">*@



        <div>

            <div style="padding:5rem">
                <header class="page-header">
                    <div class="row">
                        <div class="col-md-6 company-logo">
                            <img src="C:\Users\danny\Desktop\OrderForm\images\cetarix-logo.png" width="400" alt="Centarix Logo">
                        </div>
                        <div class="col-md-3 offset-2 company-info">
                            <h3 style="font-weight: 700;">Centarix Biotech</h3>
                            <span>ID: 51565512</span><br>
                            <span>Hamarpeh 3, Jerusalem</span><br>
                            <span>Tel: 073-7896888</span>
                        </div>
                    </div>
                    <hr>
                </header>
                <div class="row">
                    <div class="col-md-6">
                        <h1>Purchase Order: @Model.Request.ParentRequest.OrderNumber</h1>
                    </div>
                    <div class="col-md-3 offset-2">
                        <p id="date"></p>
                    </div>
                </div>
                <hr>
                <div class="row">
                    <div class="col-md-6">
                        <div class="vendor-info">
                            <h3 style="font-weight: 700;">@Model.Request.Product.Vendor.VendorEnName</h3>
                            <span>ID: @Model.Request.Product.Vendor.VendorBuisnessID</span><br>
                            <span>@Model.Request.Product.Vendor.VendorCity</span><br>
                            <span>Tel: @Model.Request.Product.Vendor.VendorContactPhone1</span>
                        </div>
                    </div>
                    @*<div class="col-md-3 offset-2">
                <div class="note-message">
                    <h3>Please Note</h3>
                    <span>We need this order by next Sunday. Thank you!</span>
                </div>
            </div>*@
                </div>
                <br><br>
                <div class="row">
                    <table class="table">
                        <thead style="background-color: #D0001C; color: #ffffff;">
                            <tr>
                                <th>Items</th>
                                <th>ID</th>
                                <th>Units</th>
                                <th>Price</th>
                                <th>Total</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td style="font-weight: 500;">@Model.Request.SubUnit @Model.Request.Product.ProductName</td>
                                <td>@Model.Request.CatalogNumber</td>
                                <td>@Model.Request.Unit</td>
                                @{double unitPrice = (Model.Request.Cost) / (Model.Request.Unit);}
                                <td>@unitPrice</td>
                                <td>@Model.Request.Cost</td>
                            </tr>

                            <tr>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td>Total</td>
                                <td>@Model.Request.Cost</td>
                            </tr>
                            <tr>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td>Discount @*@Html.DisplayFor(modelItem => Model.Request.)*@</td>
                                @*@{double discount = Model.Request.Cost * Model.Request.Discount; }*@
                                <td>@*discount*@</td>

                            </tr>

                            <tr>

                                <td></td>

                                <td></td>

                                <td></td>

                                <td>Total Price</td>
                                @*@{ double totalWithDis = Model.Request.Cost - discount}*@
                                <td>@*@totalWithDis*@</td>

                            </tr>

                            <tr>

                                <td></td>

                                <td></td>

                                <td></td>

                                <td>VAT [17%]</td>
                                @* @{ double vat = totalWithDis * Model.Request.VAT }*@
                                <td>@*@vat*@</td>

                            </tr>

                            <tr>

                                <td></td>

                                <td></td>

                                <td></td>

                                <td style="font-weight: bold;">Total To Pay</td>

                                <td style="font-weight: bold;">@*@vat+totalWithDis*@</td>

                            </tr>

                        </tbody>

                    </table>

                </div>

                <div class="row">
                    <div class="col-3 offset-1">
                        <div class="signature">
                            <img src="C:/Users/danny/Desktop/OrderForm/images/logo_signature.png" alt="signature" width="300">
                        </div>
                    </div>
                </div>
                <br>
                <br>
                <br>
                <br>
                <br>
                <div class="row">
                    <div class="col-md-12">
                        <div class="payment-terms">
                            <h3 style="font-weight: bold;">Payment Terms</h3>
                            <span>@Model.Request.Terms</span>
                        </div>
                    </div>
                </div>
                <br>
                <br>
                <br>
                <div class="modal-footer">
                    <input type="submit" class="btn btn-success" asp-action="ConfirmEmailModal" value="Confirm & Send Email" />
                    <button class="btn btn-danger close" data-dismiss="modal">Cancel Email</button>@*FAIGE: should this delete the request?*@
                </div>
            </div>

            

            <script>
                var today = new Date();
                var date = today.getDate() + '/' + (today.getMonth() + 1) + '/' + today.getFullYear();
                document.getElementById("date").innerHTML = date;
            </script>
        </div>

        </form>
            }

        </div>
    </div>
</div>
<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>