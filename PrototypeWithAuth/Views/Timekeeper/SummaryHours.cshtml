@model List<EmployeeHours>
@using Microsoft.AspNetCore.Identity
@using PrototypeWithAuth.Data
@inject UserManager<ApplicationUser> UserManager

@{
    ViewData["Title"] = "Summary Hours";
    Layout = "~/Views/Shared/TimeKeeperView.cshtml";
}
<div class="ml-6 mt-4">

    <div class="row mb-6">
        <div class="col-7">
       
            <div class="row">
                <h3 class="col-9"><strong>Monthly Summary</strong></h3>
                <div class="col-2 offset-1 monthsHours">
                    <select class="mdb-select  timekeeper select-dropdown" name="DOBMonth"  >
                        <option>Month</option>
                        <option value="1">January</option>
                        <option value="2">Febuary</option>
                        <option value="3">March</option>
                        <option value="4">April</option>
                        <option value="5">May</option>
                        <option value="6">June</option>
                        <option value="7">July</option>
                        <option value="8">August</option>
                        <option value="9">September</option>
                        <option value="10">October</option>
                        <option value="11">November</option>
                        <option value="12">December</option>
                    </select>
                </div>
      
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-7" id="hoursTable">
            <div class="row mt-6 p-3 text-center">
                <div class="col-4 pl-5 text-left">
                    Date
                </div>
                <div class="col-2">

                </div>
                <div class="col-2">
                    Entry Time
                </div>
                <div class="col-2">
                    Exit Time
                </div>
                <div class="col-2">
                    Total
                </div>
            </div>
            @foreach (var eh in Model)
            {
                <div class="row border p-3 text-center">
                    <div class="col-4 pl-5 text-left">
                        @eh.Date.ToLongDateString()
                    </div>
                    <div class="col-2  timekeeper-font-color">
                        @eh.OffDayType?.Description
                    </div>
                    <div class="col-2 p-0">
                        @if (eh.Entry1 == null && eh.OffDayType == null)
                        {
                            <button type="button" class="rounded-pill timekeeper-font-color no-box-shadow py-2 px-3 report-sick-days" style="background: transparent; border: .125rem solid var(--timekeeper-color);">Report Sick</button>
                        }
                        @eh.Entry1?.ToShortTimeString()
                        <br />
                        @eh.Entry2?.ToShortTimeString()
                    </div>
                    <div class="col-2 p-0">
                        @if (eh.OffDayType == null && eh.Exit1 == null || (eh.Entry2 != null && eh.Exit2 == null))
                        {
                            <button type="button" class="rounded-pill timekeeper-color text-white no-box-shadow border-0 py-2 px-3 mt-1 open-update-hours-modal">Update Hours</button>
                        }
                        else if (eh.OffDayType != null && ((eh.Entry1 != null && eh.Exit1 == null) || (eh.Entry2 != null && eh.Exit2 == null)))
                        {
                            <button type="button" class="rounded-pill timekeeper-color text-white no-box-shadow border-0 py-2 px-3 mt-1 open-update-hours-modal">Update Hours</button>
                        }
                        @eh.Exit1?.ToShortTimeString()
                        <br />
                        @eh.Exit2?.ToShortTimeString()

                    </div>

                    <div class="col-2  timekeeper-font-color font-weight-bold">
                        @{var hours = eh.TotalHours == TimeSpan.Zero ? "" : eh.TotalHours?.ToString(@"h\:mm"); }
                        @hours
                    </div>

                </div>

            }
            <div class="row mt-6 py-4 pl-3 text-center">
                <div class="col-2">
                    Work Days
                </div>
                <div class="col-2">
                    Sick Days
                </div>
                <div class="col-2">
                    Vacation Days
                </div>
                <div class="col-6  text-right pr-5">
                    Total Hours
                </div>
            </div>
            <div class="row mt-2 p-4  border  text-center" style="border-color: var(--timekeeper-color) !important;">
                <div class="col-2">
                    @Model.Where(eh => eh.OffDayTypeID == null).Count()
                </div>
                <div class="col-2">
                    @Model.Where(eh => eh.OffDayTypeID == 1).Count()
                </div>
                <div class="col-2">
                    @Model.Where(eh => eh.OffDayTypeID == 2).Count()
                </div>
                <div class="col-6 text-right pr-5 timekeeper-font-color font-weight-bold">
                    @{ var sum = new TimeSpan(Model.Select(eh => new { TimeSpan = eh.TotalHours?.Ticks ?? 0 }).Sum(a => a.TimeSpan)); }
                    @sum.ToString(@"hh\:mm")

                </div>
            </div>

        </div>
    </div>
</div>
<script>
    $('.mdb-select').materialSelect();
</script>